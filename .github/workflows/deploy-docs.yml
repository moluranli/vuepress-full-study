name: Build and Deploy VuePress Site

on:
  push:
    branches:
      - main  # åªåœ¨ main åˆ†æ”¯æŽ¨é€æ—¶è§¦å‘

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout ðŸ›Žï¸
      uses: actions/checkout@v3
      with:
        fetch-depth: 0  # èŽ·å–å®Œæ•´æäº¤åŽ†å²

    - name: Setup Node.js ðŸ”§
      uses: actions/setup-node@v3
      with:
        node-version: 18
        cache: 'npm'

    - name: Install dependencies ðŸ“¦
      run: npm install

    - name: Create VuePress config file ðŸ“„
      run: |
        mkdir -p docs/.vuepress
        cat > docs/.vuepress/config.js <<EOF
        module.exports = {
          title: 'My VuePress Site',
          description: 'Just playing around',
          
          // ç¦ç”¨ Markdown ä¸¥æ ¼æ¨¡å¼çš„æ ¸å¿ƒé…ç½®
          markdown: {
            html: true,         // å…è®¸ HTML
            breaks: true,       // å…è®¸æ¢è¡Œç¬¦
            linkify: true,      // è‡ªåŠ¨é“¾æŽ¥ URL
            typographer: true,  // æŽ’ç‰ˆå¢žå¼º
            strict: false      // ç¦ç”¨ä¸¥æ ¼æ¨¡å¼
          },
          
          // å¯é€‰ï¼šè‡ªå®šä¹‰ä¸»é¢˜é…ç½®
          themeConfig: {
            nav: [
              { text: 'Home', link: '/' },
              { text: 'Guide', link: '/guide/' }
            ],
            sidebar: 'auto'
          }
        }
        EOF

    - name: Build project ðŸ—ï¸
      run: npm run build

    - name: Deploy to GitHub Pages ðŸš€
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: docs/.vuepress/dist