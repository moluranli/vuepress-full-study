name: Build and Deploy VuePress Site

on:
  push:
    branches:
      - main  # 只在 main 分支推送时触发

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout 🛎️
      uses: actions/checkout@v3
      with:
        fetch-depth: 0  # 获取完整提交历史

    - name: Setup Node.js 🔧
      uses: actions/setup-node@v3
      with:
        node-version: 18
        cache: 'npm'

    - name: Install dependencies 📦
      run: npm install

    - name: Create VuePress config file 📄
      run: |
        mkdir -p docs/.vuepress
        cat > docs/.vuepress/config.js <<EOF
        module.exports = {
          title: 'My VuePress Site',
          description: 'Just playing around',
          
          // 禁用 Markdown 严格模式的核心配置
          markdown: {
            html: true,         // 允许 HTML
            breaks: true,       // 允许换行符
            linkify: true,      // 自动链接 URL
            typographer: true,  // 排版增强
            strict: false      // 禁用严格模式
          },
          
          // 可选：自定义主题配置
          themeConfig: {
            nav: [
              { text: 'Home', link: '/' },
              { text: 'Guide', link: '/guide/' }
            ],
            sidebar: 'auto'
          }
        }
        EOF

    - name: Build project 🏗️
      run: npm run build

    - name: Deploy to GitHub Pages 🚀
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: docs/.vuepress/dist